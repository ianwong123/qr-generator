<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Generator Tool</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body { 
            font-family: monospace; 
            max-width: 600px; 
            margin: 40px auto; 
            padding: 20px; 
            background: #fff; 
            color: #000; 
        }
        h1 { border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
        
        /* INSTRUCTIONS BOX */
        .instructions {
            background: #f4f4f4;
            border: 1px solid #000;
            padding: 20px;
            margin-bottom: 30px;
            font-size: 14px;
            line-height: 1.6;
        }
        .instructions strong { text-decoration: underline; }
        .step-block { margin-bottom: 15px; }
        .note-block { 
            margin-top: 15px; 
            padding-top: 15px; 
            border-top: 1px dashed #999; 
            font-style: italic; 
            color: #444;
        }
        
        /* TABS */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        
        button { 
            background: #eee; 
            color: #000; 
            border: 1px solid #000; 
            padding: 10px 20px; 
            cursor: pointer; 
            font-family: monospace; 
            font-size: 16px; 
            
            /* Fixes for Mobile/iOS */
            -webkit-appearance: none;
            border-radius: 0;
        }

        button.active { 
            background: #000; 
            color: #fff; 
        }

        @media (hover: hover) {
            button:hover { background: #ccc; }
        }
        
        /* FORMS */
        .section { display: none; border: 1px solid #000; padding: 20px; margin-bottom: 20px; }
        .section.visible { display: block; }
        
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        
        input { 
            width: 100%; 
            padding: 10px; 
            margin: 5px 0 15px 0; 
            border: 1px solid #000; 
            box-sizing: border-box; 
            font-family: monospace; 
            font-size: 14px;
            
            /* Mobile input  */
            -webkit-appearance: none;
            border-radius: 0;
        }
        
        .help { font-size: 12px; color: #555; margin-bottom: 10px; display: block; }
        
        /* QR OUTPUT */
        #qr-container { 
            margin-top: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            border: 2px dashed #000; 
            padding: 20px; 
        }
        #qr-code img { margin: 10px auto; }
        
        /* LABEL PREVIEW */
        #label-display {
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
            margin-top: 10px;
            font-family: sans-serif; 
            text-align: center;
            word-wrap: break-word;
            max-width: 100%;
        }

        /* ACTIONS */
        .action-row { display: flex; gap: 10px; width: 100%; margin-top: 20px; }
        
        .btn-action { 
            flex: 1; 
            padding: 15px; 
            font-weight: bold; 
            cursor: pointer; 
            font-family: monospace; 
            border: 1px solid #000;
            text-align: center;
            text-decoration: none;
            display: flex; align-items: center; justify-content: center;
            
            /* Mobile Fixes */
            color: #000;
            -webkit-appearance: none;
            border-radius: 0;
        }
        
        .print-btn { background: #fff; color: #000; }
        @media (hover: hover) { .print-btn:hover { background: #eee; } }
        
        .download-btn { background: #000; color: #fff; }
        @media (hover: hover) { .download-btn:hover { opacity: 0.8; } }

        /* PRINT OUTPUT  */
        @media print {
            .action-row, h1, .tabs, .section, .help, .input-group, .instructions { display: none !important; }
            
            html, body {
                width: 100%; height: 100%; margin: 0 !important; padding: 0 !important;
            }

            #qr-container { 
                position: fixed; 
                top: 0; left: 0; 
                width: 100vw; height: 100vh; 
                margin: 0 !important; padding: 0 !important;
                border: none !important; 
                display: flex; flex-direction: column; 
                align-items: center; justify-content: center; 
                z-index: 9999; background: white;
            }
            
            #qr-code img {
                width: 400px !important; height: auto !important; margin-bottom: 20px !important;
            }
            
            #label-display {
                font-size: 48px !important; width: 80%; 
                word-wrap: break-word !important; word-break: break-all !important;
                text-align: center;
            }
        }
    </style>
</head>
<body>

    <h1>QR GENERATOR</h1>

    <div class="instructions">
        <strong>HOW TO USE:</strong><br><br>
        
        <div class="step-block">
            1. <strong>Any Link:</strong> Use this to generate a standard QR code for any website.
        </div>

        <div class="step-block">
            2. <strong>Any Photo:</strong> Use this to link to a photo file.
            <ul style="margin-top: 5px; margin-bottom: 5px;">
                <li>Enter a filename (e.g. <code>foobar.jpg</code>).</li>
                <li>Print the label.</li>
                <li><strong>Email the label and photo to:</strong> Ianwong2111@gmail.com</li>
                
                <li style="margin-top: 10px; color: #d00;">
                    <strong>Important:</strong> If you plan to link to a photo, the QR code is unique to the exact filename. Even a small change (e.g. <code>foo-bar.jpg</code> vs <code>foobar.jpg</code>) creates a completely
                    different QR code. 
                    Do not change the filename or re-generate the QR code after you email it, otherwise <strong>the printed QR will not work</strong>. Your QR code will start working
                    only after we upload the file on our end.
                    When scanned, <strong>Any Photo</strong> URLs specifically will start with <code>ianwong123.github.io...</code>. This is normal and cannot be changed because we do not have a custom domain.
                </li>
            </ul>
        </div>

        <div class="note-block">
            * Note: This tool is designed for convenience, it is not a private storage server. Which means your images are hosted <strong>publicly</strong> on
            GitHub and anyone with the link can see them. So by using this tool, you accept the risk of sharing public information.
            <strong>As the repository owner, I will never use your images for personal use or gain.</strong>
            Send an email to the above if you have privacy concerns or need your image taken down. Do not send any images that contain sensitive information. It will be ignored!
        </div>
    </div>

    <div class="tabs">
        <button onclick="switchTab('link')" id="btn-link" class="active">1. Any Link</button>
        <button onclick="switchTab('photo')" id="btn-photo">2. Any Photo</button>
    </div>

    <div id="sec-link" class="section visible">
        <label>Enter Destination URL:</label>
        <input type="text" id="input-url" placeholder="https://google.com" oninput="updateView()">
        <span class="help">Generates a standard QR code for the link provided.</span>
    </div>

    <div id="sec-photo" class="section">
        <label>Enter Filename (e.g., april.jpg):</label>
        <input type="text" id="input-filename" placeholder="april.jpg" oninput="updateView()">
        <span class="help">
            <strong>Reminder:</strong> Must include the extension (e.g., .jpg) and ensure the filename matches your actual photo file exactly, including capital letters. 
            The image will be stored on the target server. <strong>If the filename does not match exactly, 
                scanning the QR code will show a '404 Not Found' error - even after the photo is added on our end.</strong>        </span>
        <div style="background: #eee; padding: 5px; font-size: 12px; margin-top:10px; font-family: monospace;">
            Target: <span id="preview-url">...</span>
        </div>
    </div>

    <div style="border: 1px solid #000; padding: 20px; margin-bottom: 20px;">
        <label>Label Text (Appears on PDF/Print):</label>
        <input type="text" id="input-label" placeholder="e.g. FOOBAR (Optional)" oninput="updateView()">
    </div>

    <div id="qr-container">
        <div id="qr-code"></div>
        <div id="label-display"></div>
        
        <div class="action-row">
            <button class="btn-action print-btn" onclick="printPage()">PRINT LABEL</button>
            <button class="btn-action download-btn" onclick="downloadPDF()">DOWNLOAD PDF</button>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const REPO_BASE = "https://ianwong123.github.io/qr-generator/assets/";

        // 1. Tab Switching 
        function switchTab(mode) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('visible'));
            document.querySelectorAll('.tabs button').forEach(el => el.classList.remove('active'));
            document.getElementById('sec-' + mode).classList.add('visible');
            document.getElementById('btn-' + mode).classList.add('active');
            
            // Clear outputs
            document.getElementById("qr-code").innerHTML = "";
            document.getElementById("label-display").innerText = "";
            document.getElementById("input-url").value = ""; 
            document.getElementById("input-filename").value = "";
            
            updateView();
        }

        // 2. Helper: Get Filename for PDF Save
        function getFileNameSlug() {
            const raw = document.getElementById("input-label").value;
            if (!raw || raw.trim() === "") { return "qr"; }
            return raw.trim().toLowerCase().replace(/\s+/g, '-');
        }

        // 3. Core Update Logic
        function updateView() {
            const isPhoto = document.getElementById('sec-photo').classList.contains('visible');
            let finalUrl = "";
            
            if (isPhoto) {
                const filename = document.getElementById("input-filename").value;
                if (filename) {
                    finalUrl = REPO_BASE + filename;
                    document.getElementById("preview-url").innerText = finalUrl;
                }
            } else {
                finalUrl = document.getElementById("input-url").value;
            }

            const labelText = document.getElementById("input-label").value;
            document.getElementById("label-display").innerText = labelText;

            const container = document.getElementById("qr-code");
            container.innerHTML = ""; 
            if (finalUrl) {
                new QRCode(container, {
                    text: finalUrl,
                    width: 200,
                    height: 200,
                    correctLevel : QRCode.CorrectLevel.H
                });
            }
        }

        // 4. Print Page
        function printPage() {
            document.title = getFileNameSlug();
            window.print();
        }

        // 5. Download PDF
        function downloadPDF() {
            const isPhoto = document.getElementById('sec-photo').classList.contains('visible');
            let finalUrl = "";
            if(isPhoto) {
                const fname = document.getElementById("input-filename").value;
                if(fname) finalUrl = REPO_BASE + fname;
            } else {
                finalUrl = document.getElementById("input-url").value;
            }

            if(!finalUrl) { alert("Please enter a URL or Filename first."); return; }

            const labelText = document.getElementById("input-label").value;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const qrImg = document.querySelector("#qr-code img");
            if (qrImg) {
                doc.addImage(qrImg.src, 'PNG', 55, 30, 100, 100); 
            }

            if (labelText) {
                doc.setFont("helvetica", "bold");
                doc.setFontSize(30);
                const pageWidth = doc.internal.pageSize.getWidth();
                doc.text(labelText.toUpperCase(), pageWidth / 2, 150, { 
                    align: "center", maxWidth: 180
                });
            }
            doc.save(getFileNameSlug() + ".pdf");
        }
    </script>
</body>
</html>